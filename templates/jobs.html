<!DOCTYPE html>
<html>
<head>
    <title>Recruiter Jobs</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

<nav class="navbar navbar-dark bg-primary">
    <div class="container">
        <span class="navbar-brand mb-0 h1">JobPortal ‚Äì Recruiter</span>
    </div>
</nav>

<div class="container mt-4">

    <!-- Header -->
    <div class="mb-3">
        <h3 class="fw-bold">üïí Recently Posted Jobs (By You)</h3>
        <p class="text-muted">Manage and track jobs you have posted.</p>
    </div>

    <!-- Search & Filters Panel -->
    <form method="GET" action="/" class="search-panel mb-4">

        <div class="row g-3 align-items-center">
            <div class="col-lg-6">
                <label class="form-label mb-1">Search Jobs</label>
                <input type="text" name="q" class="form-control"
                       placeholder="Job title, skill, company (e.g. Java Developer)"
                       value="{{ q }}">
            </div>

            <div class="col-lg-4">
                <label class="form-label mb-1">Location</label>
                <input type="text" name="location" class="form-control"
                       placeholder="All Locations"
                       value="{{ location_filter }}">
            </div>

            <div class="col-lg-2 d-grid">
                <label class="form-label mb-1">&nbsp;</label>
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">Search</button>
                    <a href="/" class="btn btn-outline-secondary">Clear</a>
                </div>
            </div>
        </div>

        <div class="row g-3 mt-3">
            <div class="col-lg-6">
                <label class="form-label mb-1">Job Type:</label><br>
                {% set jt = job_type_filter %}
                <div class="d-flex flex-wrap gap-3">
                    <label><input type="radio" name="job_type" value="all" {{ 'checked' if jt=='all' }}> All</label>
                    <label><input type="radio" name="job_type" value="Full Time" {{ 'checked' if jt=='Full Time' }}> Full-time</label>
                    <label><input type="radio" name="job_type" value="Part Time" {{ 'checked' if jt=='Part Time' }}> Part-time</label>
                    <label><input type="radio" name="job_type" value="Internship" {{ 'checked' if jt=='Internship' }}> Internship</label>
                    <label><input type="radio" name="job_type" value="Remote" {{ 'checked' if jt=='Remote' }}> Remote</label>
                </div>
            </div>

            <div class="col-lg-6">
                <label class="form-label mb-1">Experience:</label><br>
                {% set ef = exp_filter %}
                <div class="d-flex flex-wrap gap-3">
                    <label><input type="radio" name="exp" value="any" {{ 'checked' if ef=='any' }}> Any</label>
                    <label><input type="radio" name="exp" value="0-1" {{ 'checked' if ef=='0-1' }}> 0‚Äì1 yrs</label>
                    <label><input type="radio" name="exp" value="1-3" {{ 'checked' if ef=='1-3' }}> 1‚Äì3 yrs</label>
                    <label><input type="radio" name="exp" value="3+" {{ 'checked' if ef=='3+' }}> 3+ yrs</label>
                </div>
            </div>
        </div>

        <div class="mt-3 text-muted small">
            Showing {{ total }} job(s)
        </div>
    </form>

    <!-- Create Job Button -->
    <div class="d-flex justify-content-end mb-3">
        <button type="button" class="btn btn-success"
                data-bs-toggle="modal"
                data-bs-target="#createJobModal">
            + Create Job
        </button>
    </div>

    <!-- Job Cards -->
    {% for job in jobs %}
    <div class="job-card mb-3">

        <div class="d-flex justify-content-between">
            <div>
                <p class="label-title">üë®‚Äçüíº Position</p>
                <h5 class="fw-bold mb-1">{{ job.title }}</h5>

                <p class="company-line mb-1">
                    <span class="company-name">{{ job.company }}</span> ‚Ä¢
                    <span class="text-muted">{{ job.location }}</span> ‚Ä¢
                    <span class="text-muted">Exp: {{ job.experience }}</span> ‚Ä¢
                    <span class="text-muted">Posted: {{ job.posted_ago }}</span>
                </p>

                <span class="tag mt-1">{{ job.job_type }}</span>
            </div>

            <div class="text-end">
                <p class="salary-text">{{ job.salary }}</p>
            </div>
        </div>

        <div class="mt-2">
            {% if job.skills %}
                {% for skill in job.skills.split(',') %}
                    <span class="skill-pill">{{ skill.strip() }}</span>
                {% endfor %}
            {% else %}
                <span class="text-muted small">No skills specified</span>
            {% endif %}
        </div>

        <details class="mt-3">
            <summary>üîç View Details</summary>
            <div class="details-box">
                <p class="section-title">üìÑ Description</p>
                <p>{{ job.description }}</p>

                <p class="section-title">üß© Responsibilities</p>
                <p>{{ job.responsibilities }}</p>

                <p class="section-title">üéì Qualifications</p>
                <p>{{ job.qualifications }}</p>
            </div>
        </details>

        <div class="d-flex gap-2 mt-3">
            <button type="button" class="btn btn-warning btn-sm"
                    data-bs-toggle="modal"
                    data-bs-target="#editJobModal{{ job.id }}">
                ‚úèÔ∏è Edit
            </button>

            <a href="/delete-job/{{ job.id }}"
               onclick="return confirm('Are you sure?');"
               class="btn btn-danger btn-sm">
                üóë Delete
            </a>
        </div>

    </div>

    <!-- Edit Job Modal -->
    <div class="modal fade" id="editJobModal{{ job.id }}" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title">‚úèÔ∏è Edit Job</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <form action="/update-job/{{ job.id }}" method="POST">
                    <div class="modal-body">

                        <label class="form-label">Job Title</label>
                        <input type="text" name="title" class="form-control" value="{{ job.title }}" required>

                        <label class="form-label mt-3">Company</label>
                        <input type="text" name="company" class="form-control" value="{{ job.company }}" required>

                        <label class="form-label mt-3">Location</label>
                        <input type="text" name="location" class="form-control" value="{{ job.location }}">

                        <label class="form-label mt-3">Salary</label>
                        <input type="text" name="salary" class="form-control" value="{{ job.salary }}">

                        <label class="form-label mt-3">Experience</label>
                        <input type="text" name="experience" class="form-control" value="{{ job.experience }}">

                        <label class="form-label mt-3">Job Type</label>
                        <select name="job_type" class="form-control">
                            <option {{ 'selected' if job.job_type=='Full Time' }}>Full Time</option>
                            <option {{ 'selected' if job.job_type=='Part Time' }}>Part Time</option>
                            <option {{ 'selected' if job.job_type=='Internship' }}>Internship</option>
                            <option {{ 'selected' if job.job_type=='Remote' }}>Remote</option>
                        </select>

                        <label class="form-label mt-3">Skills</label>
                        <input type="text" name="skills" class="form-control" value="{{ job.skills }}">

                        <label class="form-label mt-3">Description</label>
                        <textarea name="description" class="form-control">{{ job.description }}</textarea>

                        <label class="form-label mt-3">Responsibilities</label>
                        <textarea name="responsibilities" class="form-control">{{ job.responsibilities }}</textarea>

                        <label class="form-label mt-3">Qualifications</label>
                        <textarea name="qualifications" class="form-control">{{ job.qualifications }}</textarea>

                    </div>

                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary w-100">üíæ Save Changes</button>
                    </div>
                </form>

            </div>
        </div>
    </div>

    {% endfor %}

</div>

<!-- Create Job Modal -->
<div class="modal fade" id="createJobModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">üöÄ Create New Job</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <form action="/submit-job" method="POST">
                <div class="modal-body">

                    <label class="form-label">Job Title</label>
                    <input type="text" name="title" class="form-control" required>

                    <label class="form-label mt-3">Company</label>
                    <input type="text" name="company" class="form-control" required>

                    <label class="form-label mt-3">Location</label>
                    <input type="text" name="location" class="form-control">

                    <label class="form-label mt-3">Salary</label>
                    <input type="text" name="salary" class="form-control">

                    <label class="form-label mt-3">Experience</label>
                    <input type="text" name="experience" class="form-control">

                    <label class="form-label mt-3">Job Type</label>
                    <select name="job_type" class="form-control">
                        <option>Full Time</option>
                        <option>Part Time</option>
                        <option>Internship</option>
                        <option>Remote</option>
                    </select>

                    <label class="form-label mt-3">Skills</label>
                    <input type="text" name="skills" class="form-control">

                    <label class="form-label mt-3">Description</label>
                    <textarea name="description" class="form-control"></textarea>

                    <label class="form-label mt-3">Responsibilities</label>
                    <textarea name="responsibilities" class="form-control"></textarea>

                    <label class="form-label mt-3">Qualifications</label>
                    <textarea name="qualifications" class="form-control"></textarea>

                </div>

                <div class="modal-footer">
                    <button type="submit" class="btn btn-success w-100">üíæ Create Job</button>
                </div>

            </form>
        </div>
    </div>
</div>

<!-- Toast Notification -->
<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 2000;">
    {% with messages = get_flashed_messages(with_categories=True) %}
    {% if messages %}
        {% for category, message in messages %}
        <div class="toast text-bg-{{ 'success' if category=='success' else 'danger' if category=='danger' else 'primary' }} border-0"
             role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="2500">
            <div class="d-flex">
                <div class="toast-body fw-semibold">
                    {{ message }}
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto"
                        data-bs-dismiss="toast"></button>
            </div>
        </div>
        {% endfor %}
    {% endif %}
    {% endwith %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const toasts = document.querySelectorAll('.toast');
    toasts.forEach(t => new bootstrap.Toast(t).show());
});
</script>

</body>
</html>
